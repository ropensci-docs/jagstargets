<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="jagstargets">
<title>Bayesian simulation pipelines with jagstargets • jagstargets</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian simulation pipelines with jagstargets">
<meta property="og:description" content="jagstargets">
<meta property="og:image" content="https://docs.ropensci.org/jagstargets/logo.svg">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Mathjax --><script type="text/javascript" id="MathJax-script" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.min.js">
</script><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">jagstargets</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Vignettes</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://docs.ropensci.org/targets">targets</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://CRAN.R-project.org/package=R2jags">R2jags</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://mcmc-jags.sourceforge.net">JAGS</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/jagstargets">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="simulation_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="simulation_files/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="simulation_files/vis-9.1.0/vis-network.min.js"></script><script src="simulation_files/visNetwork-binding-2.1.2/visNetwork.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Bayesian simulation pipelines with jagstargets</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/jagstargets/blob/HEAD/vignettes/simulation.Rmd" class="external-link"><code>vignettes/simulation.Rmd</code></a></small>
      <div class="d-none name"><code>simulation.Rmd</code></div>
    </div>

    
    
<p>The <a href="https://docs.ropensci.org/jagstargets/articles/introduction.html">introductory vignette</a> vignette caters to Bayesian data analysis workflows with few datasets to analyze. However, it is sometimes desirable to run one or more Bayesian models repeatedly across many simulated datasets. Examples:</p>
<ol style="list-style-type: decimal">
<li>Validate the implementation of a Bayesian model, using simulation to determine how reliably the model estimates the parameters under known data-generating scenarios.</li>
<li>Simulate a randomized controlled experiment to explore frequentist properties such as power and Type I error.</li>
</ol>
<p>This vignette focuses on (1). The goal of this particular example to simulate multiple datasets from the model below, analyze each dataset, and assess how often the estimated posterior intervals cover the true parameters from the prior predictive simulations. The quantile method by <span class="citation">Cook, Gelman, and Rubin (2006)</span> generalizes this concept, and simulation-based calibration <span class="citation">(Talts et al. 2020)</span> generalizes further. The interval-based technique featured in this vignette is not as robust as SBC, but it may be more expedient for large models because it does not require visual inspection of multiple histograms.</p>
<p>Consider a simple regression model with a continuous response <code>y</code> with a covariate <code>x</code>.</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\stackrel{\text{iid}}{\sim} \text{Normal}(\beta_1 + x_i \beta_2, 1) \\
\beta_1, \beta_2 &amp;\stackrel{\text{iid}}{\sim} \text{Normal}(0, 1)
\end{aligned}
\]</span></p>
<p>We write this model in a JAGS model file.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines</span> <span class="op">&lt;-</span> <span class="st">"model {</span></span>
<span><span class="st">  for (i in 1:n) {</span></span>
<span><span class="st">    y[i] ~ dnorm(beta[1] + x[i] * beta[2], 1)</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">  for (i in 1:2) {</span></span>
<span><span class="st">    beta[i] ~ dnorm(0, 1)</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">}"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"model.jags"</span><span class="op">)</span></span></code></pre></div>
<p>Next, we define a pipeline to simulate multiple datasets and fit each dataset with the model. In our data-generating function, we put the true parameter values of each simulation in a special <code>.join_data</code> list. <code>jagstargets</code> will automatically join the elements of <code>.join_data</code> to the correspondingly named variables in the summary output. This will make it super easy to check how often our posterior intervals capture the truth. As for scale, generate 20 datasets (5 batches with 4 replications each) and run the model on each of the 20 datasets.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Internally, each batch is a &lt;a href="https://books.ropensci.org/targets/dynamic.html" class="external-link"&gt;dynamic branch target&lt;/a&gt;, and the number of replications determines the amount of work done within a branch. In the general case, &lt;a href="https://books.ropensci.org/targets/dynamic.html#batching" class="external-link"&gt;batching&lt;/a&gt; is a way to find the right compromise between target-specific overhead and the horizontal scale of the pipeline.&lt;/p&gt;'><sup>1</sup></a> By default, each of the 20 model runs computes 3 MCMC chains with 2000 MCMC iterations each (including burn-in) and you can adjust with the <code>n.chains</code> and <code>n.iter</code> arguments of <code><a href="../reference/tar_jags_rep_summary.html">tar_jags_rep_summary()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># _targets.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/jagstargets/">jagstargets</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>crayon.enabled <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Use computer memory more sparingly:</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html" class="external-link">tar_option_set</a></span><span class="op">(</span>memory <span class="op">=</span> <span class="st">"transient"</span>, garbage_collection <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">generate_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, to <span class="op">=</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="co"># Elements of .join_data get joined on to the .join_data column</span></span>
<span>  <span class="co"># in the summary output next to the model parameters</span></span>
<span>  <span class="co"># with the same names.</span></span>
<span>  <span class="va">.join_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="va">beta</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, .join_data <span class="op">=</span> <span class="va">.join_data</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/tar_jags_rep_summary.html">tar_jags_rep_summary</a></span><span class="op">(</span></span>
<span>    <span class="va">model</span>,</span>
<span>    <span class="st">"model.jags"</span>,</span>
<span>    data <span class="op">=</span> <span class="fu">generate_data</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    parameters.to.save <span class="op">=</span> <span class="st">"beta"</span>,</span>
<span>    batches <span class="op">=</span> <span class="fl">5</span>, <span class="co"># Number of branch targets.</span></span>
<span>    reps <span class="op">=</span> <span class="fl">4</span>, <span class="co"># Number of model reps per branch target.</span></span>
<span>    variables <span class="op">=</span> <span class="st">"beta"</span>,</span>
<span>    summaries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="op">~</span><span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/quantile2.html" class="external-link">quantile2</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We now have a pipeline that runs the model 10 times: 5 batches (branch targets) with 4 replications per batch.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html" class="external-link">tar_visnetwork</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">Warning message:</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; package ‘targets’ was built under R version 4.3.3 </span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span></span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item" id="htmlwidget-117f8ab76827d84ff913" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-117f8ab76827d84ff913">{"x":{"nodes":{"name":["model","model_batch","model_data","model_file_model","model_lines_model","model_model","generate_data"],"type":["stem","stem","pattern","stem","stem","pattern","function"],"description":[null,null,null,"model.jags","model.jags","model.jags",null],"status":["outdated","outdated","outdated","outdated","outdated","outdated","outdated"],"seconds":[null,null,null,null,null,null,null],"bytes":[null,null,null,null,null,null,null],"branches":[null,null,null,null,null,null,null],"label":["model","model_batch","model_data","model_file_model\nmodel.jags","model_lines_model\nmodel.jags","model_model\nmodel.jags","generate_data"],"color":["#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5"],"id":["model","model_batch","model_data","model_file_model","model_lines_model","model_model","generate_data"],"level":[4,1,2,1,2,3,1],"shape":["dot","dot","square","dot","dot","square","triangle"]},"edges":{"from":["model_file_model","generate_data","model_batch","model_data","model_lines_model","model_model"],"to":["model_lines_model","model_data","model_data","model_model","model_model","model"],"arrows":["to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Stem","Pattern","Function"],"color":["#78B7C5","#899DA4","#899DA4","#899DA4"],"shape":["dot","dot","square","triangle"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><p>Run the computation with <code><a href="https://docs.ropensci.org/targets/reference/tar_make.html" class="external-link">tar_make()</a></code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_make.html" class="external-link">tar_make</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched target model_batch</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed target model_batch [0 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched target model_file_model</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed target model_file_model [0 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched branch model_data_b0b9380a</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed branch model_data_b0b9380a [0.01 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched branch model_data_ffcdb73c</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed branch model_data_ffcdb73c [0.005 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched branch model_data_b968a03a</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed branch model_data_b968a03a [0.004 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched branch model_data_f8763cb2</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed branch model_data_f8763cb2 [0.005 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched branch model_data_0bfdabdc</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed branch model_data_0bfdabdc [0.004 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed pattern model_data</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched target model_lines_model</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed target model_lines_model [0 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched branch model_model_5d061b58</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed branch model_model_5d061b58 [0.235 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched branch model_model_a9336683</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed branch model_model_a9336683 [0.176 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched branch model_model_bde6a6d6</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed branch model_model_bde6a6d6 [0.181 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched branch model_model_384f982f</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed branch model_model_384f982f [0.177 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched branch model_model_0d59666a</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed branch model_model_0d59666a [0.189 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed pattern model_model</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched target model</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed target model [0.001 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> ended pipeline [2.184 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; Warning message:</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; package ‘targets’ was built under R version 4.3.3 </span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span></span></span></code></pre></div>
<p>The result is an aggregated data frame of summary statistics, where the <code>.rep</code> column distinguishes among individual replicates. We have the posterior intervals for <code>beta</code> in columns <code>q2.5</code> and <code>q97.5</code>. And thanks to the <code>.join_data</code> list we included in <code>generate_data()</code>, our output has a <code>.join_data</code> column with the true values of the parameters in our simulations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_load.html" class="external-link">tar_load</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">model</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 40 × 9</span></span></span>
<span><span class="co">#&gt;    variable   q2.5   q97.5 .join_data .dataset_id      .rep    .seed .file .name</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> beta[1]  -<span style="color: #BB0000;">0.766</span>  0.414      0.078<span style="text-decoration: underline;">0</span> model_data_b0b9… 5a0c… -<span style="color: #BB0000;">1.49</span><span style="color: #949494;">e</span>9 mode… model</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> beta[2]  -<span style="color: #BB0000;">1.19</span>   0.574      0.272  model_data_b0b9… 5a0c… -<span style="color: #BB0000;">1.49</span><span style="color: #949494;">e</span>9 mode… model</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> beta[1]   0.456  1.66       1.19   model_data_b0b9… b7a4…  2.04<span style="color: #949494;">e</span>9 mode… model</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> beta[2]  -<span style="color: #BB0000;">0.832</span>  0.960      0.063<span style="text-decoration: underline;">5</span> model_data_b0b9… b7a4…  2.04<span style="color: #949494;">e</span>9 mode… model</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> beta[1]   1.32   2.49       2.15   model_data_b0b9… 5c64…  4.83<span style="color: #949494;">e</span>8 mode… model</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> beta[2]  -<span style="color: #BB0000;">1.90</span>  -<span style="color: #BB0000;">0.169</span>     -<span style="color: #BB0000;">1.71</span>   model_data_b0b9… 5c64…  4.83<span style="color: #949494;">e</span>8 mode… model</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> beta[1]  -<span style="color: #BB0000;">0.242</span>  0.940      0.271  model_data_b0b9… 04f5…  6.64<span style="color: #949494;">e</span>8 mode… model</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> beta[2]  -<span style="color: #BB0000;">1.70</span>   0.063<span style="text-decoration: underline;">6</span>    -<span style="color: #BB0000;">0.407</span>  model_data_b0b9… 04f5…  6.64<span style="color: #949494;">e</span>8 mode… model</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> beta[1]   0.671  1.86       1.44   model_data_ffcd… 4fa1… -<span style="color: #BB0000;">1.33</span><span style="color: #949494;">e</span>9 mode… model</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> beta[2]  -<span style="color: #BB0000;">1.15</span>   0.636     -<span style="color: #BB0000;">0.579</span>  model_data_ffcd… 4fa1… -<span style="color: #BB0000;">1.33</span><span style="color: #949494;">e</span>9 mode… model</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 30 more rows</span></span></span></code></pre></div>
<p>Now, let’s assess how often the estimated 95% posterior intervals capture the true values of <code>beta</code>. If the model is implemented correctly, the coverage value below should be close to 95%. (Ordinarily, we would <a href="https://books.ropensci.org/targets/dynamic.html#batching" class="external-link">increase the number of batches and reps per batch</a> and <a href="https://books.ropensci.org/targets/hpc.html" class="external-link">run batches in parallel computing</a>.)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>coverage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">q2.5</span> <span class="op">&lt;</span> <span class="va">.join_data</span> <span class="op">&amp;</span> <span class="va">.join_data</span> <span class="op">&lt;</span> <span class="va">q97.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   variable coverage</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> beta[1]      0.95</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> beta[2]      0.95</span></span></code></pre></div>
<p>For maximum reproducibility, we should express the coverage assessment as a custom function and a target in the pipeline.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># _targets.R</span></span>
<span><span class="co"># packages needed to define the pipeline:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/jagstargets/">jagstargets</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html" class="external-link">tar_option_set</a></span><span class="op">(</span></span>
<span>  packages <span class="op">=</span> <span class="st">"dplyr"</span>, <span class="co"># packages needed to run the pipeline</span></span>
<span>  memory <span class="op">=</span> <span class="st">"transient"</span>, <span class="co"># memory efficiency</span></span>
<span>  garbage_collection <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># memory efficiency</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">generate_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, to <span class="op">=</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="co"># Elements of .join_data get joined on to the .join_data column</span></span>
<span>  <span class="co"># in the summary output next to the model parameters</span></span>
<span>  <span class="co"># with the same names.</span></span>
<span>  <span class="va">.join_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="va">beta</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, .join_data <span class="op">=</span> <span class="va">.join_data</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/tar_jags_rep_summary.html">tar_jags_rep_summary</a></span><span class="op">(</span></span>
<span>    <span class="va">model</span>,</span>
<span>    <span class="st">"model.jags"</span>,</span>
<span>    data <span class="op">=</span> <span class="fu">generate_data</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    parameters.to.save <span class="op">=</span> <span class="st">"beta"</span>,</span>
<span>    batches <span class="op">=</span> <span class="fl">5</span>, <span class="co"># Number of branch targets.</span></span>
<span>    reps <span class="op">=</span> <span class="fl">4</span>, <span class="co"># Number of model reps per branch target.</span></span>
<span>    variables <span class="op">=</span> <span class="st">"beta"</span>,</span>
<span>    summaries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="op">~</span><span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/quantile2.html" class="external-link">quantile2</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span></span>
<span>    <span class="va">coverage</span>,</span>
<span>    <span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>        coverage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">q2.5</span> <span class="op">&lt;</span> <span class="va">.join_data</span> <span class="op">&amp;</span> <span class="va">.join_data</span> <span class="op">&lt;</span> <span class="va">q97.5</span><span class="op">)</span>,</span>
<span>        .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The new <code>coverage</code> target should the only outdated target, and it should be connected to the upstream <code>model</code> target.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html" class="external-link">tar_visnetwork</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">Warning message:</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; package ‘targets’ was built under R version 4.3.3 </span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span></span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item" id="htmlwidget-4c757f6c5061f93aff52" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-4c757f6c5061f93aff52">{"x":{"nodes":{"name":["model","model_batch","model_data","model_file_model","model_lines_model","model_model","coverage","generate_data"],"type":["stem","stem","pattern","stem","stem","pattern","stem","function"],"description":[null,null,null,"model.jags","model.jags","model.jags",null,null],"status":["uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","outdated","uptodate"],"seconds":[0.001,0,0.028,0,0,0.958,null,null],"bytes":[4283,99,3017,128,144,7505,null,null],"branches":[null,null,5,null,null,5,null,null],"label":["model","model_batch","model_data","model_file_model\nmodel.jags","model_lines_model\nmodel.jags","model_model\nmodel.jags","coverage","generate_data"],"color":["#354823","#354823","#354823","#354823","#354823","#354823","#78B7C5","#354823"],"id":["model","model_batch","model_data","model_file_model","model_lines_model","model_model","coverage","generate_data"],"level":[4,1,2,1,2,3,5,1],"shape":["dot","dot","square","dot","dot","square","dot","triangle"]},"edges":{"from":["model_file_model","generate_data","model_batch","model","model_data","model_lines_model","model_model"],"to":["model_lines_model","model_data","model_data","coverage","model_model","model_model","model"],"arrows":["to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Outdated","Stem","Pattern","Function"],"color":["#354823","#78B7C5","#899DA4","#899DA4","#899DA4"],"shape":["dot","dot","dot","square","triangle"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><p>When we run the pipeline, only the coverage assessment should run. That way, we skip all the expensive computation of simulating datasets and running MCMC multiple times.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_make.html" class="external-link">tar_make</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped target model_batch</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped target model_file_model</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped branch model_data_b0b9380a</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped branch model_data_ffcdb73c</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped branch model_data_b968a03a</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped branch model_data_f8763cb2</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped branch model_data_0bfdabdc</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped pattern model_data</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped target model_lines_model</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped branch model_model_5d061b58</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped branch model_model_a9336683</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped branch model_model_bde6a6d6</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped branch model_model_384f982f</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped branch model_model_0d59666a</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped pattern model_model</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">✔</span><span style="color: #BB0000;"> skipped target model</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> dispatched target coverage</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #00BB00;">●</span><span style="color: #BB0000;"> completed target coverage [0.017 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span><span style="color: #0000BB;">▶</span><span style="color: #BB0000;"> ended pipeline [0.201 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; Warning message:</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; package ‘targets’ was built under R version 4.3.3 </span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span></span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_read.html" class="external-link">tar_read</a></span><span class="op">(</span><span class="va">coverage</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   variable coverage</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> beta[1]      0.95</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> beta[2]      0.95</span></span></code></pre></div>
<div class="section level2">
<h2 id="multiple-models">Multiple models<a class="anchor" aria-label="anchor" href="#multiple-models"></a>
</h2>
<p><code>tar_jags_rep_mcmc_summary()</code> and similar functions allow you to supply multiple jags models. If you do, each model will share the the same collection of datasets, and the <code>.dataset_id</code> column of the model target output allows for custom analyses that compare different models against each other. Below, we add a new <code>model2.jags</code> file to the <code>jags_files</code> argument of <code>tar_jags_rep_mcmc_summary()</code>. In the coverage summary below, we group by <code>.name</code> to compute a coverage statistic for each model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines</span> <span class="op">&lt;-</span> <span class="st">"model {</span></span>
<span><span class="st">  for (i in 1:n) {</span></span>
<span><span class="st">    y[i] ~ dnorm(beta[1] + x[i] * x[i] * beta[2], 1) # Regress on x^2, not x.</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">  for (i in 1:2) {</span></span>
<span><span class="st">    beta[i] ~ dnorm(0, 1)</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">}"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"model2.jags"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># _targets.R</span></span>
<span><span class="co"># packages needed to define the pipeline:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/jagstargets/">jagstargets</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html" class="external-link">tar_option_set</a></span><span class="op">(</span></span>
<span>  packages <span class="op">=</span> <span class="st">"dplyr"</span>, <span class="co"># packages needed to run the pipeline</span></span>
<span>  memory <span class="op">=</span> <span class="st">"transient"</span>, <span class="co"># memory efficiency</span></span>
<span>  garbage_collection <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># memory efficiency</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">generate_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, to <span class="op">=</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="co"># Elements of .join_data get joined on to the .join_data column</span></span>
<span>  <span class="co"># in the summary output next to the model parameters</span></span>
<span>  <span class="co"># with the same names.</span></span>
<span>  <span class="va">.join_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="va">beta</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, .join_data <span class="op">=</span> <span class="va">.join_data</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/tar_jags_rep_summary.html">tar_jags_rep_summary</a></span><span class="op">(</span></span>
<span>    <span class="va">model</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"model.jags"</span>, <span class="st">"model2.jags"</span><span class="op">)</span>, <span class="co"># another model</span></span>
<span>    data <span class="op">=</span> <span class="fu">generate_data</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    parameters.to.save <span class="op">=</span> <span class="st">"beta"</span>,</span>
<span>    batches <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    reps <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"beta"</span>,</span>
<span>    summaries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="op">~</span><span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/quantile2.html" class="external-link">quantile2</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span></span>
<span>    <span class="va">coverage</span>,</span>
<span>    <span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>coverage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">q2.5</span> <span class="op">&lt;</span> <span class="va">.join_data</span> <span class="op">&amp;</span> <span class="va">.join_data</span> <span class="op">&lt;</span> <span class="va">q97.5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In the graph below, notice how targets <code>model_model1</code> and <code>model_model2</code> are both connected to <code>model_data</code> upstream. Downstream, <code>model</code> is equivalent to <code>dplyr::bind_rows(model_model1, model_model2)</code>, and it will have special columns <code>.name</code> and <code>.file</code> to distinguish among all the models.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html" class="external-link">tar_visnetwork</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">Warning message:</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; package ‘targets’ was built under R version 4.3.3 </span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span></span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item" id="htmlwidget-e82bb6a0f3f09b032488" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-e82bb6a0f3f09b032488">{"x":{"nodes":{"name":["coverage","model","model_batch","model_data","model_file_model","model_lines_model","model_model","model_file_model2","model_lines_model2","model_model2","generate_data"],"type":["stem","stem","stem","pattern","stem","stem","pattern","stem","stem","pattern","function"],"description":[null,null,null,null,"model.jags","model.jags","model.jags","model2.jags","model2.jags","model2.jags",null],"status":["outdated","outdated","uptodate","uptodate","uptodate","uptodate","uptodate","outdated","outdated","outdated","uptodate"],"seconds":[0.017,0.001,0,0.028,0,0,0.958,null,null,null,null],"bytes":[173,4283,99,3017,128,144,7505,null,null,null,null],"branches":[null,null,null,5,null,null,5,null,null,null,null],"label":["coverage","model","model_batch","model_data","model_file_model\nmodel.jags","model_lines_model\nmodel.jags","model_model\nmodel.jags","model_file_model2\nmodel2.jags","model_lines_model2\nmodel2.jags","model_model2\nmodel2.jags","generate_data"],"color":["#78B7C5","#78B7C5","#354823","#354823","#354823","#354823","#354823","#78B7C5","#78B7C5","#78B7C5","#354823"],"id":["coverage","model","model_batch","model_data","model_file_model","model_lines_model","model_model","model_file_model2","model_lines_model2","model_model2","generate_data"],"level":[5,4,1,2,1,2,3,1,2,3,1],"shape":["dot","dot","dot","square","dot","dot","square","dot","dot","square","triangle"]},"edges":{"from":["model_data","model_lines_model","model_file_model","model","generate_data","model_batch","model_model","model_model2","model_data","model_lines_model2","model_file_model2"],"to":["model_model","model_model","model_lines_model","coverage","model_data","model_data","model","model","model_model2","model_model2","model_lines_model2"],"arrows":["to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Up to date","Stem","Pattern","Function"],"color":["#78B7C5","#354823","#899DA4","#899DA4","#899DA4"],"shape":["dot","dot","dot","square","triangle"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-cook2006" class="csl-entry">
Cook, Samantha R., Andrew Gelman, and Donald B. Rubin. 2006. <span>“Validation of Software for Bayesian Models Using Posterior Quantiles.”</span> <em>Journal of Computational and Graphical Statistics</em> 15 (3): 675–92.
</div>
<div id="ref-talts2020" class="csl-entry">
Talts, Sean, Michael Betancourt, Daniel Simpson, Aki Vehtari, and Andrew Gelman. 2020. <span>“Validating Bayesian Inference Algorithms with Simulation-Based Calibration.”</span>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
